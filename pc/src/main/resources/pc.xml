<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pcns">
<select id="selectPcbnm" parameterType="string" resultType="pc">
		select * from pc where pcbusinessnum = #{pcbusinessnum}
	</select>
	
	<select id="selectPcpno" parameterType="string" resultType="pc">
		select * from pc where pcpno = #{pcpno}
	</select>
	
	<select id="givePcno" resultType="integer">
	select nvl(max(pcno),0) + 1 from pc
	</select>
	
	<insert id="insertPc" parameterType="pc">
		insert into pc (pcno,pcbusinessnum,pcpno,pcname,pcaddr,pcinfo,imagename) values(#{pcno},#{pcbusinessnum}, #{pcpno}, #{pcname}, #{pcaddr}, #{pcinfo}, #{imagename})
	</insert>
	<insert id="insertPcimage" parameterType="java.util.List">
		insert all
		<foreach collection="list" item="item">
		into pcimage values (get_seq, ${item.pcno}, '${item.imagename}' )
		</foreach>
		select * from dual
	</insert>
	<insert id="insertPi" parameterType="pcimage">
		insert into pcimage values(pcimage_seq.nextval, #{pcno},#{imagename})
	</insert>
	<insert id="insertSeat" parameterType="seat">
		<selectKey keyProperty="seatno" order="BEFORE" resultType="integer">
			select nvl(max(seatno), 0) + 1 seatno from seat
		</selectKey>
		insert into seat values(#{seatno}, #{seatposition}, #{pcno})
	</insert>
	
	<select id="select" parameterType="integer" resultType="pc">
		select * from pc where pcno=#{pcno}
	</select>
	<select id="listPhoto" parameterType="integer" resultType="pcimage">
		select * from pcimage where pcno=#{pcno}
	</select>
	<select id="selectSeat" parameterType="integer" resultType="seat">
		select * from seat where pcno=#{pcno}
	</select>
	<select id="listSeat" parameterType="integer" resultType="string">
		select seatposition from seat where pcno=#{pcno}
	</select>
	
	<update id="updateSeat" parameterType="seat">
		update seat set seatposition=#{seatposition} where pcno=#{pcno}
	</update>
	<update id="updateseatform" parameterType="pc">
		update pc set seatlow=#{seatlow}, seatcol=#{seatcol} where pcno=#{pcno}
	</update>
	<select id="pcList" parameterType="pc" resultType="pc">
		select * from(select a.*, rowNum rn from(select * from pc 
		<where>
			<if test="searchValue!=null and searchValue!=''">
				${searchKey} like '%'||#{searchValue}||'%'
			</if>	
		</where>	
		order by pcno desc)a) 
			where rn between #{startRow} and #{endRow}
	</select>
	<update id="permit" parameterType="integer">
		update pc set permit = 'y' where pcno=#{pcno}
	</update>
	<select id="getTotal" resultType="integer">
		select count(*) from pc 
		<where>
			<if test="searchValue!=null and searchValue!=''">
				${searchKey} like '%'||#{searchValue}||'%'
			</if>	
		</where>
	</select>
	<!-- main에서 좌표를 찍기위해 모든 pc정보를 불러온다 -->
	<select id="listMap" resultType="pc">
		select * from pc
	</select>	
</mapper>